# EDA precipitation

In this section we want study the time series of precipitation in the
Central Amazon Basin.
The CHIRPS data set contains the **precipitation data**, created from in-situ and satellite measurements (@funk2015climate). It can be downloaded for example from here [https://www.chc.ucsb.edu/data/chirps].
It contains observations **from 1981 to 2021**. Data comes on a **high resolution of 0.05 grid**.

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo=FALSE, warning = FALSE, message = FALSE)
#knitr::opts_knit$set(root.dir="../")
```


```{r}
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(raster)
library(patchwork)
library(ggpubr)
```

```{r}
source("../code/R/helper-functions.R")
```

```{r, include=FALSE}
world <- ne_countries(scale = "medium", returnclass = "sf")
# class(world)
theme_set(theme_bw())
```
Time frame: 1980 to 2016

## Overview

Below the area of the Central Amazon Basin that is object of our study.

```{r, echo=FALSE, fig.cap="Localisation of the area under study. The central amazon basin (CAB) spanning across 0,-10 latitude and -70,-55 longitude"}
(cab_square_plot <- readRDS("../results/eda/cab_square_plot.rds"))
```

## Precipitation values raw

Firstly we inspect the precipitation values in general
```{r}
(precip_dens_plot <- readRDS("../results/eda/precip_dens_plot.rds"))
```
Its form is a unimodal, right-skewed distribution.
The values range from `r[1]` tom `r[2]`.


## Mean at each location
```{r, fig.cap="Precipitation mean at each location. The mean was computed over the whole time period"}
(precip_means_loc_plot <- readRDS("../results/eda/precip_means_loc_plot.rds"))
```

```{r, fig.cap="Density of means, means were computed for each location over the whole time period"}
(precip_mean_dens_plot <- readRDS("../results/eda/precip_means_dens_plot.rds"))
```

As we can see most locations have a mean precipitation of around 200 mm/month, over
the whole time series. Regionally in the "upper left" corner of the Amazon Basin,
mean precipitation is higher or equal to the mean. The reference
point for "higher" is the mean of the location means. This region seems to be more
or less spatially consistent. The rest of the region with lower mean precipitation
has also some small areas where precipitation is again a little bit higher. 
For example in the upper right corner and on the bottom, right of the middle.


## SD at each location
```{r, fig.cap="Precipitation standard deviation at each location. The standard deviation was computed over the whole time period"}
(precip_sds_loc_plot <- readRDS("../results/eda/precip_sds_loc_plot.rds"))
```

```{r, fig.cap="Density of standard deviations, standard deviations were computed for each location over the whole time period"}
(precip_sds_dens_plot <- readRDS("../results/eda/precip_sds_dens_plot.rds"))
```

For the standard deviation we also see regional patterns. These patterns overlap
with the regions of the mean but their magnitude is flipped. Meaning,
in the upper left where we observe larger mean values we generally observe lower
standard deviation and in the lower and upper right corners, higher standard 
deviations.

Question: There are obviously regional differences in magnitude of mean
and standard deviations. Should we therefore NOT normalise the time series, prior
to clustering? Mean and SD contain information and the variables are all measured 
on the same scale. (Consideration: seasonality might play a role, meaning
that the values of different months come a different distribution)

## Mean and SD at each location

```{r}
precip_means_loc_plot + precip_sds_loc_plot
```
```{r}
(precip_mean_dens_plot + ggtitle("Density of means")) + (precip_sds_dens_plot + ggtitle("Density of sd"))
```


## Trend at each location

```{r, include=FALSE}
a <- readRDS("../results/eda/precip_trends_loc_lm_plot.rds")
b <- readRDS("../results/eda/precip_trends_loc_stl_plot.rds")
a + b
```
```{r}
(precip_trends_loc_stl_plot <- readRDS("../results/eda/precip_trends_loc_stl_plot.rds"))
```


Many regions dont have a trend and trends in general seem to be quite small.
We can identify some regions with similar up or downward trends.
We also computed plots for the deseasonalised data but it looked almost the same

Plot means and sd for each month respectively

```{r}

```

<!-- ## Means per month -->
<!-- ### January -->

<!-- ```{r} -->
<!-- mon_mean[[1]] -->
<!-- ``` -->

<!-- ### February -->

<!-- ```{r} -->
<!-- mon_mean[[2]] -->
<!-- ``` -->

<!-- ### March -->

<!-- ```{r} -->
<!-- mon_mean[[3]] -->
<!-- ``` -->

<!-- ### April -->

<!-- ```{r} -->
<!-- mon_mean[[4]] -->
<!-- ``` -->

<!-- ### May -->

<!-- ```{r} -->
<!-- mon_mean[[5]] -->
<!-- ``` -->

<!-- ### June -->

<!-- ```{r} -->
<!-- mon_mean[[6]] -->
<!-- ``` -->


<!-- ### July -->

<!-- ```{r} -->
<!-- mon_mean[[7]] -->
<!-- ``` -->

<!-- ### August -->

<!-- ```{r} -->
<!-- mon_mean[[8]] -->
<!-- ``` -->

<!-- ### September -->

<!-- ```{r} -->
<!-- mon_mean[[9]] -->
<!-- ``` -->

<!-- ### October -->

<!-- ```{r} -->
<!-- mon_mean[[10]] -->
<!-- ``` -->

<!-- ### November -->

<!-- ```{r} -->
<!-- mon_mean[[11]] -->
<!-- ``` -->

<!-- ### December -->

<!-- ```{r} -->
<!-- mon_mean[[12]] -->
<!-- ``` -->


<!-- ### {-} -->

<!-- We see spatial patterns of the mean evolving over time. -->
<!-- For example: From May until August there is a spatial separation in -->
<!-- two parts that dissolves in september. -->
<!-- As expected there is a large seasonal component regarding the means. -->


## Means per month TEST

```{r}
(precip_mean_arrange <- readRDS("../results/eda/precip_mean_arrange.rds"))
```
We see spatial patterns of the mean evolving over time.
For example: From May until August there is a spatial separation in
two parts that dissolves in september.
As expected there is a large seasonal component regarding the means.

<!-- ## SD per month -->

<!-- ### January -->

<!-- ```{r} -->
<!-- mon_sd[[1]] -->
<!-- ``` -->

<!-- ### February -->

<!-- ```{r} -->
<!-- mon_sd[[2]] -->
<!-- ``` -->

<!-- ### March -->

<!-- ```{r} -->
<!-- mon_sd[[3]] -->
<!-- ``` -->

<!-- ### April -->

<!-- ```{r} -->
<!-- mon_sd[[4]] -->
<!-- ``` -->

<!-- ### May -->

<!-- ```{r} -->
<!-- mon_sd[[5]] -->
<!-- ``` -->

<!-- ### June -->

<!-- ```{r} -->
<!-- mon_sd[[6]] -->
<!-- ``` -->


<!-- ### July -->

<!-- ```{r} -->
<!-- mon_sd[[7]] -->
<!-- ``` -->

<!-- ### August -->

<!-- ```{r} -->
<!-- mon_sd[[8]] -->
<!-- ``` -->

<!-- ### September -->

<!-- ```{r} -->
<!-- mon_sd[[9]] -->
<!-- ``` -->

<!-- ### October -->

<!-- ```{r} -->
<!-- mon_sd[[10]] -->
<!-- ``` -->

<!-- ### November -->

<!-- ```{r} -->
<!-- mon_sd[[11]] -->
<!-- ``` -->

<!-- ### December -->

<!-- ```{r} -->
<!-- mon_sd[[12]] -->
<!-- ``` -->

<!-- ### {-} -->

<!-- For the standard deviation we see as well large differences in values  -->
<!-- during different months of the year. -->

```{r, include = FALSE}
#Do we get stationary time series when we only take each january or february?
#Check for stationarity of the different time series?
#### Open: summarise CAB for each month (mean Jan, Feb, etc.)
```

## SD per month TEST

```{r}
(precip_sd_arrange <- readRDS("../results/eda/precip_sd_arrange.rds"))
```

For the standard deviation we see as well large differences in values 
during different months of the year.

## Trend per month TEST

```{r}
(precip_trend_arrange <- readRDS("../results/eda/precip_trend_arrange.rds"))
```


